CC = gcc

OPTIMIZE_FLAG = -O0
WARNING_EQUALLY_ERROR_FLAG = -Werror

COMPILE_FLAGS = -Wall $(WARNING_EQUALLY_ERROR_FLAG) $(OPTIMIZE_FLAG) -g
NCURSES_FLAG = -lncurses

SOURCE_PATH = src
BUILD_PATH = build
BINARY_PATH = bin

MAIN_FILE = main

BINARY_KEY_START = key

EXTENSION_FILE_C_CODE = .c
EXTENSION_FILE_OBJECT = .o

ALL_SOURCES = $(shell find $(SOURCE_PATH)/ -name '*$(EXTENSION_FILE_C_CODE)')

SOURCES = $(filter-out $(SOURCE_PATH)/$(MAIN_FILE)$(EXTENSION_FILE_C_CODE), $(ALL_SOURCES))

OBJECTS = $(SOURCES:$(SOURCE_PATH)/%$(EXTENSION_FILE_C_CODE)=$(BUILD_PATH)/%$(EXTENSION_FILE_OBJECT))

.PHONY: clean all make_path run

all: make_path $(BINARY_PATH)/$(BINARY_KEY_START)

$(BINARY_PATH)/$(BINARY_KEY_START): $(BUILD_PATH)/$(MAIN_FILE)$(EXTENSION_FILE_OBJECT) $(OBJECTS)
	$(CC) $(COMPILE_FLAGS) $(BUILD_PATH)/$(MAIN_FILE)$(EXTENSION_FILE_OBJECT) -o $(BINARY_PATH)/$(BINARY_KEY_START) $(NCURSES_FLAG)

$(LIBRARY_PATH)/$(PREFIX_FILE_LIBRARY)%$(EXTENSION_FILE_DYNAMIC_LIBRARY): $(BUILD_PATH)/%$(EXTENSION_FILE_OBJECT)
	gcc -shared $^ -o $@

$(BUILD_PATH)/$(MAIN_FILE)$(EXTENSION_FILE_OBJECT): $(SOURCE_PATH)/$(MAIN_FILE)$(EXTENSION_FILE_C_CODE)
	$(CC) $(COMPILE_FLAGS) $< -c -o $@ $(NCURSES_FLAG)

$(BUILD_PATH)/%$(EXTENSION_FILE_OBJECT): $(SOURCE_PATH)/%$(EXTENSION_FILE_C_CODE)
	$(CC) $(COMPILE_FLAGS) $< -c -o $@

make_path:
	mkdir $(BINARY_PATH) -p
	mkdir $(BUILD_PATH) -p

clean:
	rm -rf $(BINARY_PATH)
	rm -rf $(BUILD_PATH)

run:
	$(LD_FLAG) ./$(BINARY_PATH)/$(BINARY_KEY_START)
